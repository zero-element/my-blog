---
title: "从零知识证明到ETH智能合约"
date: 2021-04-17
draft: true
description: "很好玩，又有点难玩，这是个哲学"
categories: [
  "开发"
]
tags: [
  "区块链"
]
---

# 零知识证明

## 什么是零知识证明

零知识证明指的是证明者能够在不向验证者提供任何有用的信息的情况下，使验证者相信某个论断是正确的

### 简单的例子

> 阿里巴巴知道打开藏着财宝的山洞的咒语。四十大盗抓住他，让他说出咒语。 如果阿里巴巴说出咒语，就会因为没有利用价值而被杀死。如果阿里巴巴坚持不说，强盗不会相信他真的掌握咒语，也会杀死他。
> 但阿里巴巴想了一个好办法，他对强盗说：“你们离我一箭之地，用弓箭指着我，你们举起右手我就念咒语打开石门，举起左手我就念咒语关上石门，如果我做不到或逃跑，你们就用弓箭射死我。”

![alibaba](.\alibaba.jpg)

> 1.强盗在A点站立，并让阿里巴巴走到B点，阿里巴巴随机的从左右两个方向进入洞穴，因此阿里巴巴可能到达C处，也可能到达D处
> 2.强盗走到B点，并随机让阿里巴巴从左边或从右边出来。如果阿里巴巴拥有密门的咒语，那么无论他现在在C点或者是在D点都可以按照强盗的指令从正确的方向走出洞穴；但如果阿里巴巴如果没有密门的咒语，那么他只有1/2的可能从正确的方向出来

只要通过足够多轮次的检查，就有极大的把握证明阿里巴巴拥有密门的咒语

### PCP定理

PCP，全称Probabilistically Checkable Proof，意思就是，所有的NP问题，都可以在多项式时间内通过概率验证的方法被证明。

因为**所有的NP问题都可以有效地转换为数学运算电路**，PCP定理指出，对于所有的电路![[公式]](https://www.zhihu.com/equation?tex=C)，我们都可以构造一套概率验证体系![[公式]](https://www.zhihu.com/equation?tex=%28S%2C+P%2C+V%29)，其工作方式如下：

![[公式]](.\PCP.svg)

S为生成算法Setup，把电路C转换成后续会用到的随机参数。

![img](.\证明体系.png)

> 证明方通过公有和私密输入生成一个证明![[公式]](https://www.zhihu.com/equation?tex=%5Cpi)，并且把证明![[公式]](https://www.zhihu.com/equation?tex=%5Cpi)**存入只读区域后共享给验证方查看**（只读区域可以防止双方篡改证明内容）。**唯一不同的是验证方并不能看到所有的![[公式]](https://www.zhihu.com/equation?tex=%5Cpi)，只能通过一个query机制来检查这个证明![[公式]](https://www.zhihu.com/equation?tex=%5Cpi)随机的![[公式]](https://www.zhihu.com/equation?tex=k)位数**。通过看完这![[公式]](https://www.zhihu.com/equation?tex=k)位数之后，验证方就需要输出验证结果。

### 从PCP到LPCP

换一个实际一点的例子

> 假如A需要向B证明她拥有一个从0到100依次升序排列的数组，那么B可以通过随机抽查的方式来验证A的数组是否正确排列。
>
> B可以抽查第49位是不是48，第3位是不是2等等来确定A是否真的拥有这么一个数组。当然，A也有可能是运气好，除了第49位和第3位其他都是乱序的。
>
> 不过当抽查的次数越来越多，A作假的可能性也会越来越低。

但是，这种单纯的抽查效率是非常低下的，验证的确信程度随着抽查次数线性提高，想要接近100%的确认就需要整个数组，开销不可接受，因此需要引**线性PCP（Linear PCP/LPCP）**

如果说PCP形容的是所有NP范围内的问题都可以通过简短的随机抽验来验证，LPCP则是说**任意一个dd阶的多项式PP，都可以通过随机验证多项式在几个点上取值来确定这个多项式的每一项系数是否满足特定的要求**。



假如取值在FF域内的多项式P(x)P(x)拥有(c0,c1,...cd)(c0,c1,...cd)的系数，那么这个dd阶多项式**在每个点上的取值一定是特殊的**。换句话说，如果我们还有一个dd阶的多项式Q(x)Q(x)，哪怕QQ的系数稍微变了一点点，整个多项式的取值马上会发生巨大的改变。**如果两个多项式P,QP,Q的系数不一样，那么如果我们随机验证一个点rr的取值P(r),Q(r)P(r),Q(r)，这两个值相等的几率会非常非常小**：

### 只读区域的实现

#### Merkle树

#### Merkle证明

# ETH智能合约

## Solidity



## Zokrates



# 安全问题